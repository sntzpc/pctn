<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker - Pencatat Pengeluaran Keluarga</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon alternate" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Ctext y='54' x='6' font-size='56'%3EðŸ’µ%3C/text%3E%3C/svg%3E" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        (function(){
        window.__XLSX_READY__ = false;

        const sources = [
            "https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js",
            "https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js",
            "./libs/xlsx.full.min.js"
        ];

        function loadFrom(i){
            if (i >= sources.length){
            console.error("[XLSX] gagal dimuat dari semua sumber");
            window.__XLSX_READY__ = false;
            window.dispatchEvent(new CustomEvent("xlsxfailed"));
            return;
            }

            const url = sources[i];
            const s = document.createElement("script");
            s.src = url;
            s.async = true;

            s.onload = () => {
            if (window.XLSX){
                window.__XLSX_READY__ = true;
                console.log("[XLSX] loaded:", url);
                window.dispatchEvent(new CustomEvent("xlsxready"));
            } else {
                console.warn("[XLSX] script ter-load tapi XLSX tidak ada, coba sumber lain:", url);
                loadFrom(i + 1);
            }
            };

            s.onerror = () => {
            console.warn("[XLSX] gagal load, coba sumber lain:", url);
            loadFrom(i + 1);
            };

            document.head.appendChild(s);
        }

        loadFrom(0);
        })();
        </script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-row">
                <div class="header-left">
                    <h1><i class="fas fa-wallet"></i> Expense Tracker</h1>
                    <p>Catat pengeluaran dengan mudah menggunakan suara dan struk</p>
                </div>

                <button id="theme-toggle" class="theme-toggle" type="button" aria-label="Ubah tema">
                    <i class="fas fa-moon"></i>
                    <span>Dark</span>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <nav class="nav-menu">
                    <ul>
                        <li><a href="#input" id="nav-input"><i class="fas fa-microphone"></i> Input Suara</a></li>
                        <li><a href="#receipt" id="nav-receipt"><i class="fas fa-receipt"></i> Input Struk</a></li>
                        <li><a href="#manual" id="nav-manual"><i class="fas fa-keyboard"></i> Input Manual</a></li>
                        <li><a href="#dashboard" class="active" id="nav-dashboard"><i class="fas fa-chart-pie"></i> Dashboard</a></li>
                        <li><a href="#stats" id="nav-stats"><i class="fas fa-chart-line"></i> Statistik</a></li>
                        <li><a href="#data" id="nav-data"><i class="fas fa-list"></i> Data Pengeluaran</a></li>
                        <li><a href="#export" id="nav-export"><i class="fas fa-file-export"></i> Export Data</a></li>
                    </ul>
                </nav>
                
                <div class="month-summary">
                    <h3><i class="fas fa-calendar-alt"></i> Ringkasan Bulan Ini</h3>
                    <div class="summary-item">
                        <span>Total Pengeluaran</span>
                        <span id="month-total">Rp 0</span>
                    </div>
                    <div class="summary-item">
                        <span>Jumlah Transaksi</span>
                        <span id="month-count">0</span>
                    </div>
                    <div class="summary-item">
                        <span>Rata-rata per Hari</span>
                        <span id="month-avg">Rp 0</span>
                    </div>
                </div>
            </aside>

            <!-- Content Area -->
            <main class="content-area">
                <!-- Dashboard Section -->
                <section id="dashboard" class="content-section active">
                    <h2><i class="fas fa-chart-pie"></i> Dashboard Laporan</h2>
                    <div class="dashboard-cards">
                        <div class="card">
                            <div class="card-icon" style="background-color: #4e73df;">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="card-info">
                                <h3>Total Pengeluaran</h3>
                                <p id="total-expense">Rp 0</p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-icon" style="background-color: #1cc88a;">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="card-info">
                                <h3>Total Transaksi</h3>
                                <p id="total-transactions">0</p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-icon" style="background-color: #f6c23e;">
                                <i class="fas fa-store"></i>
                            </div>
                            <div class="card-info">
                                <h3>Toko Favorit</h3>
                                <p id="top-store">-</p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-icon" style="background-color: #e74a3b;">
                                <i class="fas fa-tags"></i>
                            </div>
                            <div class="card-info">
                                <h3>Kategori Terbesar</h3>
                                <p id="top-category">-</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="charts-container">
                        <div class="chart-box">
                        <div class="chart-head">
                            <h3 id="daily-chart-title">Pengeluaran Harian (7 Hari Terakhir)</h3>

                            <div class="chart-controls">
                                <select id="daily-range" class="chart-select" title="Periode">
                                    <option value="today">Hari ini</option>
                                    <option value="7d" selected>7 hari terkini</option>
                                    <option value="30d">30 hari terkini</option>
                                    <option value="1y">1 tahun terkini</option>
                                    <option value="all">Semua data</option>
                                </select>

                                <select id="daily-scale" class="chart-select" title="Skala">
                                    <option value="auto" selected>Skala: Auto</option>
                                    <option value="rp">Skala: Rupiah</option>
                                    <option value="rb">Skala: Ribuan (Rb)</option>
                                    <option value="jt">Skala: Jutaan (Jt)</option>
                                    <option value="log">Skala: Log</option>
                                </select>
                            </div>
                        </div>

                        <canvas id="daily-chart"></canvas>
                    </div>
                        <div class="chart-box">
                            <h3>Pengeluaran per Kategori</h3>
                            <canvas id="category-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="recent-transactions">
                    <div class="table-head">
                        <h3>Transaksi Terbaru</h3>

                        <div class="table-tools">
                        <label class="table-tool">
                            Tampil
                            <select id="recent-page-size" class="table-select">
                            <option value="20" selected>20</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                            <option value="1000">1000</option>
                            </select>
                            data
                        </label>
                        </div>
                    </div>

                    <div class="table-container table-scroll">
                        <table id="recent-table">
                        <thead>
                            <tr>
                            <th>Tanggal</th>
                            <th>Nama Barang</th>
                            <th>Jumlah</th>
                            <th>Harga Total</th>
                            <th>Toko</th>
                            </tr>
                        </thead>
                        <tbody id="recent-table-body">
                            <tr><td colspan="5" class="empty-data">Memuat data...</td></tr>
                        </tbody>
                        </table>
                    </div>

                    <div class="pagination" id="recent-pagination"></div>
                    </div>
                </section>

                <!-- Statistik Section -->
                <section id="stats" class="content-section">
                <h2><i class="fas fa-chart-line"></i> Statistik & Analisa</h2>

                <div class="stats-toolbar">
                    <div class="stats-filter">
                    <label for="stats-range">Periode</label>
                    <select id="stats-range" class="chart-select">
                        <option value="today">Hari ini</option>
                        <option value="7d" selected>7 hari terkini</option>
                        <option value="30d">30 hari terkini</option>
                        <option value="1y">1 tahun terkini</option>
                        <option value="all">Semua data</option>
                    </select>
                    </div>

                    <div class="stats-filter">
                    <label for="stats-search">Cari barang / toko</label>
                    <input id="stats-search" type="text" placeholder="contoh: beras, indomaret, bensin..." />
                    </div>
                </div>

                <div class="stats-cards">
                    <div class="stat-card">
                    <div class="stat-title">Total Pengeluaran</div>
                    <div class="stat-value" id="stat-total">Rp 0</div>
                    <div class="stat-sub" id="stat-total-sub">Periode terpilih</div>
                    </div>

                    <div class="stat-card">
                    <div class="stat-title">Jumlah Transaksi</div>
                    <div class="stat-value" id="stat-tx">0</div>
                    <div class="stat-sub">Periode terpilih</div>
                    </div>

                    <div class="stat-card">
                    <div class="stat-title">Rata-rata / Transaksi</div>
                    <div class="stat-value" id="stat-avg-tx">Rp 0</div>
                    <div class="stat-sub">Periode terpilih</div>
                    </div>

                    <div class="stat-card">
                    <div class="stat-title">Hari Paling Boros</div>
                    <div class="stat-value" id="stat-top-day">-</div>
                    <div class="stat-sub" id="stat-top-day-sub">Rp 0</div>
                    </div>

                    <div class="stat-card">
                    <div class="stat-title">Barang Terbanyak</div>
                    <div class="stat-value" id="stat-top-item">-</div>
                    <div class="stat-sub" id="stat-top-item-sub">0 item</div>
                    </div>

                    <div class="stat-card">
                    <div class="stat-title">Barang Paling Boros</div>
                    <div class="stat-value" id="stat-top-spend-item">-</div>
                    <div class="stat-sub" id="stat-top-spend-item-sub">Rp 0</div>
                    </div>
                </div>

                <div class="stats-panels">
                    <div class="chart-box">
                    <div class="chart-head">
                        <h3>Top 10 Barang Paling Boros</h3>
                    </div>
                    <canvas id="stats-topitems-chart"></canvas>
                    </div>

                    <div class="chart-box">
                    <div class="chart-head">
                        <h3>Pengeluaran per Hari (Seninâ€“Minggu)</h3>
                    </div>
                    <canvas id="stats-weekday-chart"></canvas>
                    </div>

                    <div class="chart-box">
                    <div class="chart-head">
                        <h3>Tren Bulanan</h3>
                    </div>
                    <canvas id="stats-monthly-chart"></canvas>
                    </div>

                    <div class="chart-box">
                    <div class="chart-head">
                        <h3>Daftar Top Barang</h3>
                    </div>

                    <div class="table-container table-scroll">
                        <table>
                        <thead>
                            <tr>
                            <th>Rank</th>
                            <th>Barang</th>
                            <th style="text-align:right;">Qty</th>
                            <th style="text-align:right;">Total Belanja</th>
                            <th>Toko Terbanyak</th>
                            </tr>
                        </thead>
                        <tbody id="stats-topitems-body">
                            <tr><td colspan="5" class="empty-data">Memuat...</td></tr>
                        </tbody>
                        </table>
                    </div>
                    <div class="small" id="stats-note" style="margin-top:10px;color:#6e707e;">-</div>
                    </div>
                </div>
                </section>

                <!-- Voice Input Section -->
                <section id="input" class="content-section">
                    <h2><i class="fas fa-microphone"></i> Input dengan Rekaman Suara</h2>
                    <div class="voice-input-container">
                        <div class="instructions">
                            <h3><i class="fas fa-info-circle"></i> Cara Penggunaan</h3>
                            <p>Ucapkan pembelian dengan format seperti contoh berikut:</p>
                            <div class="example">
                                <p>"Beli <strong>Handphone</strong> sebanyak <strong>1 unit</strong> merk <strong>Iphone</strong> seharga <strong>23 juta 500 ribu rupiah</strong> di toko <strong>Eraphone</strong>."</p>
                            </div>
                            <p>Atau:</p>
                            <div class="example">
                                <p>"Beli <strong>Beras</strong> sebanyak <strong>5 kilogram</strong> merk <strong>Bunga Wangi</strong> seharga <strong>75 ribu rupiah</strong> di <strong>Supermarket Indogrosir</strong>."</p>
                            </div>
                        </div>
                        
                        <div class="voice-recorder">
                            <div class="recorder-status" id="recorder-status">
                                <i class="fas fa-microphone"></i>
                                <p>Siap merekam</p>
                            </div>
                            
                            <button id="record-btn" class="record-btn">
                                <i class="fas fa-microphone"></i> Mulai Rekam
                            </button>
                            
                            <button id="stop-btn" class="stop-btn" disabled>
                                <i class="fas fa-stop"></i> Berhenti
                            </button>
                            
                            <button id="process-btn" class="process-btn" disabled>
                                <i class="fas fa-brain"></i> Proses dengan AI
                            </button>
                            
                            <div class="audio-preview" id="audio-preview">
                                <p>Belum ada rekaman</p>
                            </div>
                        </div>
                        
                        <div class="transcription-result">
                            <h3><i class="fas fa-file-alt"></i> Hasil Transkripsi</h3>
                            <div class="result-box" id="transcription-result">
                                <p>Hasil transkripsi akan muncul di sini...</p>
                            </div>
                            
                            <h3><i class="fas fa-database"></i> Data yang Akan Disimpan</h3>
                            <div class="data-form">
                                <div class="form-group">
                                    <label for="item-name">Nama Barang</label>
                                    <input type="text" id="item-name" placeholder="Contoh: Handphone">
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="item-quantity">Jumlah Barang</label>
                                        <input type="number" id="item-quantity" placeholder="Contoh: 1" min="1">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="item-unit">Satuan</label>
                                        <input type="text" id="item-unit" placeholder="Contoh: Unit">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="item-brand">Merk</label>
                                    <input type="text" id="item-brand" placeholder="Contoh: Iphone">
                                </div>
                                
                                <div class="form-group">
                                    <label for="item-price">Harga Satuan</label>
                                    <input type="text" id="item-price" placeholder="Contoh: 23500000">
                                </div>
                                
                                <div class="form-group">
                                    <label for="item-store">Toko/Tempat Pembelian</label>
                                    <input type="text" id="item-store" placeholder="Contoh: Eraphone">
                                </div>
                                
                                <div class="form-group">
                                    <label for="item-category">Kategori</label>
                                    <select id="item-category">
                                        <option value="Makanan & Minuman">Makanan & Minuman</option>
                                        <option value="Elektronik">Elektronik</option>
                                        <option value="Pakaian & Aksesoris">Pakaian & Aksesoris</option>
                                        <option value="Rumah Tangga">Rumah Tangga</option>
                                        <option value="Kesehatan">Kesehatan</option>
                                        <option value="Transportasi">Transportasi</option>
                                        <option value="Hiburan">Hiburan</option>
                                        <option value="Lainnya">Lainnya</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="total-price">Total Harga (Otomatis)</label>
                                    <input type="text" id="total-price" readonly placeholder="Akan terhitung otomatis">
                                </div>
                                
                                <div class="form-actions">
                                    <button id="save-btn" class="save-btn">
                                        <i class="fas fa-save"></i> Simpan Data
                                    </button>
                                    <button id="clear-btn" class="clear-btn">
                                        <i class="fas fa-trash"></i> Bersihkan
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Receipt Input Section -->
                <section id="receipt" class="content-section">
                <h2><i class="fas fa-receipt"></i> Input dari Foto Struk</h2>

                <div class="receipt-container">
                    <div class="receipt-left">
                    <div class="receipt-card">
                        <h3><i class="fas fa-camera"></i> Ambil / Upload Foto Struk</h3>
                        <p class="small muted">
                        Tips: foto harus terang, tidak terpotong, dan tulisan fokus agar hasil OCR maksimal.
                        </p>

                        <input id="receipt-file" class="receipt-file" type="file" accept="image/*" capture="environment" />

                        <div class="receipt-actions">
                        <button id="receipt-process-btn" type="button" class="btn btn-primary" disabled>
                            <i class="fas fa-magic"></i> Baca Struk (AI)
                        </button>

                        <button id="receipt-clear-btn" type="button" class="btn btn-light" disabled>
                            <i class="fas fa-times"></i> Reset
                        </button>
                        </div>

                        <div id="receipt-preview" class="receipt-preview"></div>
                    </div>
                    </div>

                    <div class="receipt-right">
                    <div class="receipt-card">
                        <h3><i class="fas fa-list-check"></i> Hasil Parsing & Pilih Item</h3>
                        <div id="receipt-result" class="receipt-result">
                        <p class="small muted">Belum ada struk yang diproses.</p>
                        </div>
                    </div>
                    </div>
                </div>
                </section>

                <!-- Manual Input Section -->
                <section id="manual" class="content-section">
                    <h2><i class="fas fa-keyboard"></i> Input Manual Data Pengeluaran</h2>
                    <div class="manual-form-container">
                        <form id="manual-form">
                            <div class="form-group">
                                <label for="manual-item-name">Nama Barang *</label>
                                <input type="text" id="manual-item-name" required placeholder="Contoh: Handphone">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="manual-item-quantity">Jumlah Barang *</label>
                                    <input type="number" id="manual-item-quantity" required placeholder="Contoh: 1" min="1">
                                </div>
                                
                                <div class="form-group">
                                    <label for="manual-item-unit">Satuan *</label>
                                    <input type="text" id="manual-item-unit" required placeholder="Contoh: Unit">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="manual-item-brand">Merk</label>
                                <input type="text" id="manual-item-brand" placeholder="Contoh: Iphone">
                            </div>
                            
                            <div class="form-group">
                                <label for="manual-item-price">Harga Satuan *</label>
                                <input type="number" id="manual-item-price" required placeholder="Contoh: 23500000" min="1">
                            </div>
                            
                            <div class="form-group">
                                <label for="manual-total-price">Total Harga</label>
                                <input type="text" id="manual-total-price" readonly placeholder="Akan terhitung otomatis">
                            </div>
                            
                            <div class="form-group">
                                <label for="manual-item-store">Toko/Tempat Pembelian</label>
                                <input type="text" id="manual-item-store" placeholder="Contoh: Eraphone">
                            </div>
                            
                            <div class="form-group">
                                <label for="manual-item-category">Kategori *</label>
                                <select id="manual-item-category" required>
                                    <option value="">Pilih Kategori</option>
                                    <option value="Makanan & Minuman">Makanan & Minuman</option>
                                    <option value="Elektronik">Elektronik</option>
                                    <option value="Pakaian & Aksesoris">Pakaian & Aksesoris</option>
                                    <option value="Rumah Tangga">Rumah Tangga</option>
                                    <option value="Kesehatan">Kesehatan</option>
                                    <option value="Transportasi">Transportasi</option>
                                    <option value="Hiburan">Hiburan</option>
                                    <option value="Lainnya">Lainnya</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="manual-date">Tanggal Pembelian</label>
                                <input type="date" id="manual-date">
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="save-btn">
                                    <i class="fas fa-save"></i> Simpan Data
                                </button>
                                <button type="reset" class="clear-btn">
                                    <i class="fas fa-trash"></i> Bersihkan Form
                                </button>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- Data Pengeluaran Section -->
                <section id="data" class="content-section">
                    <h2><i class="fas fa-list"></i> Data Pengeluaran</h2>
                    <div class="data-controls">
                        <div class="filter-group">
                            <label for="filter-month">Filter Bulan:</label>
                            <select id="filter-month">
                                <option value="all">Semua Bulan</option>
                                <option value="1">Januari</option>
                                <option value="2">Februari</option>
                                <option value="3">Maret</option>
                                <option value="4">April</option>
                                <option value="5">Mei</option>
                                <option value="6">Juni</option>
                                <option value="7">Juli</option>
                                <option value="8">Agustus</option>
                                <option value="9">September</option>
                                <option value="10">Oktober</option>
                                <option value="11">November</option>
                                <option value="12">Desember</option>
                            </select>
                            
                            <label for="filter-year">Tahun:</label>
                            <select id="filter-year">
                                <option value="2023">2023</option>
                                <option value="2024" selected>2024</option>
                                <option value="2025">2025</option>
                            </select>
                            
                            <label for="filter-category">Kategori:</label>
                            <select id="filter-category">
                                <option value="all">Semua Kategori</option>
                                <option value="Makanan & Minuman">Makanan & Minuman</option>
                                <option value="Elektronik">Elektronik</option>
                                <option value="Pakaian & Aksesoris">Pakaian & Aksesoris</option>
                                <option value="Rumah Tangga">Rumah Tangga</option>
                                <option value="Kesehatan">Kesehatan</option>
                                <option value="Transportasi">Transportasi</option>
                                <option value="Hiburan">Hiburan</option>
                                <option value="Lainnya">Lainnya</option>
                            </select>
                            
                            <button id="apply-filter" class="filter-btn">
                                <i class="fas fa-filter"></i> Terapkan Filter
                            </button>
                            <button id="reset-filter" class="clear-btn">
                                <i class="fas fa-redo"></i> Reset
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container table-scroll">
                        <table id="expense-table">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Tanggal</th>
                                    <th>Nama Barang</th>
                                    <th>Jumlah</th>
                                    <th>Satuan</th>
                                    <th>Merk</th>
                                    <th>Harga Satuan</th>
                                    <th>Total Harga</th>
                                    <th>Kategori</th>
                                    <th>Toko</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="expense-table-body">
                                <tr><td colspan="11" class="empty-data">Memuat data...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="data-table-footer">
                    <div class="table-tools">
                        <label class="table-tool">
                        Tampil
                        <select id="data-page-size" class="table-select">
                            <option value="20" selected>20</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                            <option value="1000">1000</option>
                        </select>
                        data
                        </label>
                    </div>

                    <div class="pagination" id="data-pagination"></div>

                    <div class="page-info" id="page-info">Halaman 1 dari 1</div>
                    </div>
                </section>

                <!-- Export Data Section -->
                <section id="export" class="content-section">
                    <h2><i class="fas fa-file-export"></i> Export Data ke Excel</h2>
                    <div class="export-container">
                        <div class="export-options">
                            <div class="option-card">
                                <div class="option-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <h3>Export Berdasarkan Periode</h3>
                                <p>Export data pengeluaran berdasarkan rentang tanggal tertentu</p>
                                
                                <div class="date-range">
                                    <div class="form-group">
                                        <label for="export-start">Tanggal Mulai</label>
                                        <input type="date" id="export-start">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="export-end">Tanggal Akhir</label>
                                        <input type="date" id="export-end">
                                    </div>
                                </div>
                                
                                <button id="export-period" class="export-btn">
                                    <i class="fas fa-download"></i> Export Periode
                                </button>
                            </div>
                            
                            <div class="option-card">
                                <div class="option-icon">
                                    <i class="fas fa-filter"></i>
                                </div>
                                <h3>Export dengan Filter</h3>
                                <p>Export data berdasarkan kategori, toko, atau filter lainnya</p>
                                
                                <div class="export-filters">
                                    <div class="form-group">
                                        <label for="export-category">Kategori</label>
                                        <select id="export-category">
                                            <option value="all">Semua Kategori</option>
                                            <option value="Makanan & Minuman">Makanan & Minuman</option>
                                            <option value="Elektronik">Elektronik</option>
                                            <option value="Pakaian & Aksesoris">Pakaian & Aksesoris</option>
                                            <option value="Rumah Tangga">Rumah Tangga</option>
                                            <option value="Kesehatan">Kesehatan</option>
                                            <option value="Transportasi">Transportasi</option>
                                            <option value="Hiburan">Hiburan</option>
                                            <option value="Lainnya">Lainnya</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="export-store">Toko</label>
                                        <input type="text" id="export-store" placeholder="Nama toko (kosongkan untuk semua)">
                                    </div>
                                </div>
                                
                                <button id="export-filtered" class="export-btn">
                                    <i class="fas fa-download"></i> Export Filter
                                </button>
                            </div>
                            
                            <div class="option-card">
                                <div class="option-icon">
                                    <i class="fas fa-file-excel"></i>
                                </div>
                                <h3>Export Semua Data</h3>
                                <p>Export semua data pengeluaran ke file Excel</p>
                                <p class="note">Catatan: Semua data dalam spreadsheet akan di-export</p>
                                
                                <button id="export-all" class="export-btn">
                                    <i class="fas fa-download"></i> Export Semua Data
                                </button>
                            </div>
                        </div>
                        
                        <div class="export-status">
                            <h3><i class="fas fa-history"></i> Status Export</h3>
                            <div id="export-result">
                                <p>Belum ada export yang dilakukan</p>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Aplikasi Pencatatan Pengeluaran Keluarga &copy; 2026 | Dibuat dengan <i class="fas fa-heart"></i> untuk keluarga Indonesia</p>
        </footer>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <div class="toast-content">
            <i class="fas fa-check-circle toast-icon"></i>
            <div class="toast-message">Data berhasil disimpan!</div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>Memproses...</p>
    </div>

    <script>
        (function(){
        const THEME_KEY = 'expense_tracker_theme_v1';
        const root = document.documentElement; // <html data-theme="...">
        const btn = document.getElementById('theme-toggle');

        function getPreferredTheme(){
            return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
            ? 'dark'
            : 'light';
        }

        function setButtonUI(theme){
            if(!btn) return;
            const icon = btn.querySelector('i');
            const label = btn.querySelector('span');
            const isDark = theme === 'dark';

            if(icon){
            icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            }
            if(label){
            label.textContent = isDark ? 'Light' : 'Dark';
            }
            btn.setAttribute('aria-label', isDark ? 'Ubah ke Light Mode' : 'Ubah ke Dark Mode');
        }

        function applyTheme(theme, save=true){
            const t = (theme === 'dark') ? 'dark' : 'light';
            root.setAttribute('data-theme', t);
            setButtonUI(t);

            if(save){
            try { localStorage.setItem(THEME_KEY, t); } catch(e) {}
            root.setAttribute('data-theme-user', '1'); // penanda user pernah memilih
            }

            // Optional: broadcast supaya script.js bisa ikut update warna chart jika dibutuhkan
            window.dispatchEvent(new CustomEvent('themechange', { detail: { theme: t }}));
        }

        function initTheme(){
            let saved = null;
            try { saved = localStorage.getItem(THEME_KEY); } catch(e) {}
            const theme = (saved === 'dark' || saved === 'light') ? saved : getPreferredTheme();
            applyTheme(theme, false);
            if(saved === 'dark' || saved === 'light') root.setAttribute('data-theme-user', '1');
        }

        // init
        initTheme();

        // klik toggle
        if(btn){
            btn.addEventListener('click', () => {
            const cur = root.getAttribute('data-theme') || 'light';
            applyTheme(cur === 'dark' ? 'light' : 'dark', true);
            });
        }

        // kalau user belum pernah memilih, ikut perubahan sistem
        if(window.matchMedia){
            const mq = window.matchMedia('(prefers-color-scheme: dark)');
            const onChange = () => {
            const userPicked = root.getAttribute('data-theme-user') === '1';
            if(userPicked) return;
            applyTheme(getPreferredTheme(), false);
            };

            if(typeof mq.addEventListener === 'function') mq.addEventListener('change', onChange);
            else if(typeof mq.addListener === 'function') mq.addListener(onChange);
        }
        })();
        </script>

    <script src="script.js"></script>
    <script>
        (function(){
        const exportButtons = ["export-period","export-filtered","export-all"]
            .map(id => document.getElementById(id))
            .filter(Boolean);

        function setDisabled(disabled){
            exportButtons.forEach(btn => {
            btn.disabled = !!disabled;
            btn.classList.toggle("disabled", !!disabled);
            btn.title = disabled ? "Library XLSX belum siap / gagal dimuat" : "";
            });
        }

        // default: disable dulu sampai XLSX ready
        setDisabled(true);

        window.addEventListener("xlsxready", () => setDisabled(false));
        window.addEventListener("xlsxfailed", () => {
            setDisabled(true);
            // kalau Anda punya toast di script.js, ini tetap aman meski tidak ada
            console.warn("XLSX gagal dimuat. Export dinonaktifkan.");
        });

        // kalau kebetulan XLSX sudah siap cepat
        if (window.XLSX) setDisabled(false);
        })();
        </script>
</body>
</html>